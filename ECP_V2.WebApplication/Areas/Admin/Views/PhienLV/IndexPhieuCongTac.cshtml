@{
    ViewBag.Title = "Quản Lý Phiếu Công Tác";
    Layout = "~/Views/Shared/_LayoutHome.cshtml";
}

@{
    var donViRepository = new ECP_V2.Business.Repository.DonViRepository();
    string donviId = Session["DonViID"].ToString();
    var donVi = donViRepository.GetById(Session["DonViID"].ToString());
}

@section ScriptSignalR{
    <script src="~/Scripts/AdminJS/chosen/chosen.jquery.js"></script>
}

@section Styles{
    <link href="~/Scripts/AdminJS/chosen/bootstrap-chosen.css" rel="stylesheet" />
    <link href="@Url.Content("~/Content/jquery-ui-themes-1.12.1/jquery-ui.theme.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/jquery-ui-themes-1.12.1/jquery-ui.css")" rel="stylesheet" />
}
<style>
    .mfp-content {
        width: 100% !important;
        min-height: 800px !important;
    }

    .white-popup {
        position: relative;
        background: #FFF;
        padding: 0px;
        width: 100% !important;
        margin: -25px auto;
    }

    .white-popup-block {
        max-width: 100%;
    }

    /*.modal-wrapper {
        position: relative;
        padding: 25px 0;
        height: 100%;
        margin:-35px;
    }

    .panel-body{
        height:800px;
    }*/

    #popup {
        visibility: hidden;
    }
</style>
<input type="hidden" id="listLCV" value="@ViewBag.listLCV" />
<div class="head" id="ndContent">

    <!-- Modal Animation -->
    <div id="modalAnimDetail" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">
                    Chi Tiết Phiếu công tác
                    <span><a href="#" target="_blank" style="float: right; font-size: 13px;" class="btn btn-primary chi-tiet-phien-lv">Xem chi tiết</a></span>
                </h2>
            </header>
            <div class="panel-body" style="padding:0">
                <div class="modal-wrapper">

                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-default modal-dismiss" onclick="ModalDismissDetail()" id="modal-dismiss">Thoát</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!-- Modal Animation -->
    <div id="modalAnimUpdateVuaTao" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn cập nhật trạng thái Phiếu công tác này thành vừa tạo ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="UpdateVuaTaoModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="UpdateVuaTaoModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!-- Modal Animation -->
    @*<div id="modalAnimUpdateSoPhieu" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
            <section class="panel">
                <header class="panel-heading">
                    <h2 class="panel-title">Thông báo</h2>
                </header>
                <div class="panel-body">
                    <div class="modal-wrapper">
                        <div class="modal-text">
                            <div class="col-md-4">
                                Số phiếu/lệnh công tác
                            </div>
                            <div class="col-md-6">
                                <input type="text" id="txtUpdateSoPhieuCT" placeholder="Nhập số phiếu/lệnh công tác" maxlength="50" class="form-control" />
                            </div>
                        </div>
                    </div>
                </div>
                <footer class="panel-footer">
                    <div class="row">
                        <div class="col-md-12 text-right">
                            <button class="btn btn-primary modal-confirm" onclick="UpdateSoPhieuModalConfirm()" id="modal-confirm">Có</button>
                            <button class="btn btn-default modal-dismiss" onclick="UpdateSoPhieuModalDismiss()" id="modal-dismiss">Không</button>
                        </div>
                    </div>
                </footer>
            </section>
        </div>*@

    <div id="modalAnimUpdateSoPhieu" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide" style="max-width: 1200px; height: 550px;margin: 5px auto;">
        <section class="panel" style="width:100%; height:100%">
            <header class="panel-heading">
                <h2 class="panel-title plcongtac">PHIẾU/LỆNH CÔNG TÁC</h2>
                <button class="btn btn-default modal-dismiss" onclick="ClosePhieuCongTac()" id="modal-dismiss" style="position: absolute; right: 10px; top: 10px; font-size: 14px; font-weight: bold;">x</button>
            </header>
            <div class="panel-body" style="width:100%; height:100%; padding:5px 0 0 0">
                <div class="modal-wrapper" style="width:100%; height:100%; padding:0">
                    <iframe id="phieucongtacwords" src="" width="100%" height="100%" style="background:url(/Content/Customs/loading-blue.gif) no-repeat center center; border:none;"></iframe>
                </div>
            </div>
        </section>
    </div>

    <div id="modalXemPKT" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide" style="max-width: 1200px; height: 550px;margin: 5px auto;">
        <section class="panel" style="width:100%; height:100%">
            <header class="panel-heading">
                <h2 class="panel-title plcongtac">PHIẾU KIỂM TRA</h2>
                <button class="btn btn-default modal-dismiss" onclick="ClosePhieuCongTac()" id="modal-dismiss" style="position: absolute; right: 10px; top: 10px; font-size: 14px; font-weight: bold;">x</button>
            </header>
            <div class="panel-body" style="width:100%; height:100%; padding:5px 0 0 0">
                <div class="modal-wrapper" style="width:100%; height:100%; padding:0">
                    <iframe id="phieuKiemTra" src="" width="100%" height="100%" style="background:url(/Content/Customs/loading-blue.gif) no-repeat center center; border:none;"></iframe>
                </div>
            </div>
        </section>
    </div>

    <div id="modalAnimDetailPCT" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Chi Tiết Phiếu Công Tác</h2>
            </header>
            <div class="panel-body" style="padding:0">
                <div class="modal-wrapper">

                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-default modal-dismiss" onclick="ModalDismissDetail()" id="modal-dismiss">Thoát</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimComment" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thêm Nhận Xét</h2>
            </header>
            <div class="panel-body" style="padding:0">
                <div class="modal-wrapper">

                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="ModalConfirmComment(this)" id="modal-confirm">Lưu</button>
                        <button class="btn btn-default modal-dismiss" onclick="ModalDismissComment()" id="modal-dismiss">Thoát</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimDuyet" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn duyệt các Phiếu/Lệnh công tác đã chọn ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="DuyetModalConfirm()" id="modal-confirm"><span class="fa fa-check-circle" style="color: #fff;"></span> Duyệt</button>
                        <button class="btn btn-default modal-dismiss" onclick="DuyetModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!--Dialog Hủy duyệt phiếu/lệnh-->
    <!--Đã cấp số ko được hủy, Người duyệt được hủy-->
    <div id="modalAnimHuyDuyet" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn Hủy duyệt các Phiếu/Lệnh công tác đã chọn ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="HuyDuyetModalConfirm()" id="modal-confirm"><span class="fa fa-check-circle" style="color: #fff;"></span> Hủy duyệt</button>
                        <button class="btn btn-default modal-dismiss" onclick="DuyetModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimDeleteMultiple" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn xóa những Phiếu công tác này ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="DeleteMultipleModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="DeleteMultipleModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimNPC" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn duyệt Phiếu công tác Tổng công ty ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="NPCModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="NPCModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimDuyetPhieuLenhAll" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn duyệt các Phiếu/Lệnh công tác đã chọn ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="DuyetAllPhieuLenhModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="DuyetAllModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimCapSoPhieuLenhAll" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn cấp số các Phiếu/Lệnh công tác đã chọn ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="CapSoAllPhieuLenhModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="CapSoAllModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimCapSoPhieuLenh" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn cấp số Phiếu/Lệnh công tác đã chọn ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="CapSoPhieuLenhModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="CapSoModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimDuyetAll" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn duyệt Phiếu công tác này ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="DuyetAllModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="DuyetAllModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!----Modal ký số-->
    <div id="modalAnimKyso" class="zoom-anim-dialog mfp-hide">
        <section class="panel" style="height:600px !important;">
            <header class="panel-heading">
                <h2 class="panel-title">Ký số Phiếu/Lệnh công tác.</h2>
            </header>
            <div class="panel-body" style="height:600px;">
                <div class="modal-wrapper">
                    <div id="showFileKyso" style="height: 560px !important;">

                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-3 text-right">
                        <div class="modal-text" style="display: flex; flex-direction: row;">
                            <div class="form-check" style="padding-right:30px !important;">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                    EVNCA
                                </label>
                            </div>
                            <div class="form-check" style="padding-right:30px !important;">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Vinaphone
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3">
                                <label class="form-check-label" for="flexRadioDefault3">
                                    Mobiphone
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="CallSignPhieu(IdSign)" id="modal-confirm">Ký số</button>
                        <button class="btn btn-default modal-dismiss" onclick="DeleteModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!----View ký số-->
    <div id="modalViewKyso" class="white-popup-block mfp-content mfp-hide">
        <section class="panel">
            <div class="row" style="margin-top:-15px;">
                <button class="btn btn-primary" onclick="onViewSign(-1)" id="btnBack"><i class="fa fa-backward"></i></button>
                <button class="btn btn-primary" onclick="onViewSign(1)" id="btnForward"><i class="fa fa-forward"></i></button>
                <button class="btn btn-danger modal-dismiss" style="float:right;" onclick="GuiNPCAllModalDismiss()" id="modal-dismiss"><i class="fa fa-times"></i> Đóng</button>
            </div>

            <div class="panel-body" style="height:800px !important;">
                <div id="contentKyso" class="modal-wrapper" style="position: relative; padding: 25px 0; height: 100%; margin: -35px;">

                </div>
            </div>
            <div>
                <input type="hidden" id="numberFile" />
            </div>
        </section>
    </div>

    <!--Biên bản khảo sát-->
    <div id="modalBBKS" class="white-popup-block mfp-content mfp-hide">
        <section class="panel">
            <div class="row">
                <div class="col-lg-10">
                    <h2>Biên bản khảo sát</h2>
                </div>
                <div class="col-lg-2">
                    <button class="btn btn-danger modal-dismiss" style="float:right;" onclick="GuiNPCAllModalDismiss()" id="modal-dismiss"><i class="fa fa-times"></i></button>
                </div>

            </div>

            <div class="panel-body" style="height:800px !important;">
                <div class="row">
                    <div class="col-lg-8">
                        <input type="file" class="form-control" id="fileBBKS" />
                    </div>
                    <div class="col-lg-4">
                        <button type="button" class="btn btn-success" id="modal-btn-si" onclick="onUploadBBKS()">Upload file</button>
                        <button type="button" class="btn btn-primary" id="modal-btn-si" onclick="onSignBBKS()">Ký số</button>
                        @*<button type="button" class="btn btn-danger" data-dismiss="modal" id="modal-btn-no">Xem file ký</button>*@
                        <input type="hidden" id="hdIdphien" />
                    </div>
                </div>

                <div id="contentBBKS" class="modal-wrapper" style="position: relative; padding: 25px 0; height: 100%;">

                </div>
            </div>
        </section>
    </div>

    <!--Phương án thi công-->
    <div id="modalPATC" class="white-popup-block mfp-content mfp-hide">
        <section class="panel">
            <div class="row">
                <div class="col-lg-10">
                    <h2>Phương Án thi công</h2>
                </div>
                <div class="col-lg-2">
                    <button class="btn btn-danger modal-dismiss" style="float:right;" onclick="GuiNPCAllModalDismiss()"><i class="fa fa-times"></i></button>
                </div>
            </div>

            <div class="panel-body" style="height:800px !important;">
                <div class="row">
                    <div class="col-lg-8">
                        <input type="file" class="form-control" id="filePATC" />
                    </div>
                    <div class="col-lg-4">
                        <button type="button" class="btn btn-success" id="modal-btn-si" onclick="onUploadPATC()">Upload file</button>
                        <button type="button" class="btn btn-primary" onclick="onSignPATC()">Ký số</button>
                        <input type="hidden" id="hdIdphienPatc" />
                    </div>
                </div>
                <div id="contentPATC" class="modal-wrapper" style="position: relative; padding: 25px 0; height: 100%; ">

                </div>
            </div>
        </section>
    </div>

    <div id="modalAnimGuiNPCAll" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn chuyển Phiếu công tác Tổng công ty ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="GuiNPCAllModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="GuiNPCAllModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimTongHop" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-info-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3 style="text-align: center; font-size: 18px;"></h3>
                        @*<div style="margin-bottom:15px;margin-top:5px" class="input-group">
                                <span>Ngày tổng hợp : &nbsp;</span>
                                <input id="txtNgayTongHop" name="txtNgayTongHop" type="text" placeholder="Ngày Bổ Sung">
                            </div>*@
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        @*<button class="btn btn-primary modal-confirm" onclick="ModalConfirmTongHop()">Có</button>*@
                        <button class="btn btn-default modal-dismiss" onclick="ModalDismissTongHop()">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimTongHopAlert" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h4></h4>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="ModalConfirmTongHopAlert()">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="ModalDismissTongHopAlert()">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!-- Modal Animation -->
    <div id="modalAnimDelete" class="zoom-anim-dialog modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Thông báo</h2>
            </header>
            <div class="panel-body">
                <div class="modal-wrapper">
                    <div class="modal-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    <div class="modal-text">
                        <h3>Bạn có chắc muốn xóa Phiếu công tác này ?</h3>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="DeleteModalConfirm()" id="modal-confirm">Có</button>
                        <button class="btn btn-default modal-dismiss" onclick="DeleteModalDismiss()" id="modal-dismiss">Không</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimNhaySoPhieu" class="zoom-anim-dialog modal-block modal-block-md mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Nhảy số phiếu</h2>
            </header>
            <div class="panel-body">
                @*@if (ViewBag.IsTram != null)
                    {
                        <div id="divChonTram" style="display:none">
                            <label class="control-label">Chọn trạm</label>
                            <select class="form-control" id="cmbChonTram"></select>
                            <br />
                        </div>
                    }*@
                <label class="control-label">Tổng số phiếu muốn nhảy</label>
                <div class="clearfix"></div>
                <div data-plugin-spinner data-plugin-options='{ "value":1, "min": 1, "max": 9999 }'>
                    <div class="input-group input-small">
                        <input id="spintTongSoPhieuNhay" class="spinner-input form-control" onClick="this.select();" style="width:100px" />
                        <input type="hidden" id="inputLoaiPCT" value="" />
                        <div class="spinner-buttons input-group-btn btn-group-vertical" style="float:left;width:22px">
                            <button type="button" class="btn spinner-up btn-xs btn-default">
                                <i class="fa fa-angle-up"></i>
                            </button>
                            <button type="button" class="btn spinner-down btn-xs btn-default">
                                <i class="fa fa-angle-down"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="LuuNhayPhieuModalConfirm()" id="modal-confirm">Lưu</button>
                        <button class="btn btn-default modal-dismiss" onclick="CancelNhayPhieuModalConfirm()" id="modal-dismiss">Hủy</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div id="modalAnimChonSoPhieu" class="zoom-anim-dialog modal-block modal-block-xs mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Chọn số phiếu</h2>
            </header>
            <div class="panel-body">
                <select class="form-control" id="cmbChonSoPhieu"></select>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm" onclick="LuuChonPhieuModalConfirm()" id="modal-confirm">Lưu</button>
                        <button class="btn btn-default modal-dismiss" onclick="$.magnificPopup.close();" id="modal-dismiss">Hủy</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <div class="clear">
    </div>
</div>

<div class="block-fluid">
    <div class="panel panel-visible">
        <div class="panel-heading br-b-n">
            <div class="panel-title hidden-xs">
                <div class="panel-actions">
                    <a href="~/Admin/Report/Index" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;width:105px;height:28px;line-height:0; float: right;" id="export_tuan_cty">
                        <i class="fa fa-file-excel-o"></i> &nbsp; Báo cáo
                    </a>

                    @if (donVi != null)
                    {
                        if (((donviId.Length == 4 && donVi.DviCha.Equals("PA")) || donviId.ToUpper().Equals("PH") || donviId.ToUpper().Equals("PN") || donviId.ToUpper().Equals("PM")))
                        {

                        }
                        else
                        {
                            if (User.IsInRole("Manager"))
                            {
                                <a href="#modalAnimTongHop" id="btnTongHopBaoCaoCuoiNgay" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer; float: right; width: 230px; height: 28px; line-height:0;">
                                    <i class="fa fa-file-excel-o"></i> &nbsp; Tổng hợp báo cáo cuối ngày
                                </a>
                            }
                        }
                    }

                    <a href="#modalAnimTongHopAlert" id="btnTongHopBaoCaoCuoiNgayAlert" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer; float: right; width: 230px; height: 28px; line-height:0; display: none;">
                    </a>

                    <div id="datatable-default_filter" class="dataTables_filter" style="margin-right: 10px; float: right;">
                        <select class="form-control" id="cmbLoaiTimKiemText" style="float: left; width: 235px;">
                            <option value="0">Tìm theo số phiếu/lệnh</option>
                            <option value="1">Tìm theo nội dung khác</option>
                        </select>

                        <input class="form-control" type="text" placeholder="Tìm kiếm..." id="txtSearch" onkeypress="txtSearch_onKeyPress(event,this)"
                               onkeyup="txtSearch_onkeyup(event,this)" style="float: left; width: 235px;" autocomplete="on" />
                    </div>
                </div>
                <span class="glyphicon glyphicon-tasks"></span> Danh sách Phiếu Công Tác
            </div>
        </div>
        <div class="panel-body pn">
            <div class="text-center">
                @if (TempData["Notification"] != null)
                {
                    @Html.Hidden("NotificationAutoHide", TempData["NotificationAutoHide"])
                    <div id="NotificationBox" class="@TempData["NotificationCSS"]" style="display: none">
                        @Html.Raw(@TempData["Notification"])
                    </div>
                }
            </div>
            <div id="datatable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                <div class="row show-grid">
                    <div class="col-md-3">
                        <span>Đơn Vị: &nbsp;</span>
                        <select class="form-control" id="cmbDonViID" onchange="donvi_change(this)">
                            @try
                            {
                                @Html.Raw(ECP_V2.Business.Repository.DonViRepository.GetAllDonViHtml2(Session["DonViID"].ToString()))
                            }
                            catch { }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <span>Phòng Ban : &nbsp;</span>
                        @if (Session["DonViID"].ToString() == "PA")
                        {
                            <select style="width:200px;" class="form-control" id="cmbPhongBan" onchange="phongban_change(this)"></select>
                        }
                        else
                        {
                            @*if (User.IsInRole("Leader"))
                                {
                                    var phongBanRepository = new ECP_V2.Business.Repository.PhongBanRepository();
                                    var phongBan = phongBanRepository.GetById(Session["PhongBanId"].ToString());

                                    if (phongBan != null)
                                    {
                                        <select class="form-control" id="cmbPhongBan" onchange="phongban_change(this)">
                                            <option value="@phongBan.Id">@phongBan.TenPhongBan</option>
                                        </select>
                                    }
                                    else
                                    {
                                        <select class="form-control" id="cmbPhongBan" onchange="phongban_change(this)"></select>
                                    }
                                }
                                else
                                {*@
                            <select style="width:166px" class="form-control" id="cmbPhongBan" onchange="phongban_change(this)">
                                <option value="">Chọn phòng ban</option>
                                @try
                                {
                                    @Html.Raw(ECP_V2.Business.Repository.PhongBanRepository.GetPhongBanByDonViIDHtml(Session["DonViID"].ToString(), 0))
                                }
                                catch { }
                            </select>
                            @*}*@
                        }
                    </div>
                    <div class="col-md-3">
                        <span>TC Phiên : &nbsp;</span>
                        <select class="form-control" id="cmbTCPhien" onchange="tcphien_change(this)">
                            <option value="0">Tất cả</option>
                            @*<option value="CÔNG VIỆC THEO ĐĂNG KÝ KẾ HOẠCH">CÔNG VIỆC THEO ĐĂNG KÝ KẾ HOẠCH</option>
                                <option value="CÔNG VIỆC THEO ĐĂNG KÝ BỔ SUNG">CÔNG VIỆC THEO ĐĂNG KÝ BỔ SUNG</option>*@

                            @if (ViewBag.ListTCPhien != null)
                            {
                                var listTCPhien = (List<ECP_V2.DataAccess.plv_TinhChatPhien>)ViewBag.ListTCPhien;

                                foreach (var item in listTCPhien)
                                {
                                    <option value="@item.Id">@item.Name</option>
                                }
                            }

                        </select>
                    </div>
                    <div class="col-md-3">
                        <span>Phiếu/Lệnh công tác : &nbsp;</span>
                        <br />
                        <select class="form-control" id="cmbLoaiPhieu" onchange="loaiphieu_change(this)">
                            <option value="0" selected>Tất cả</option>
                            <option value="1">Phiếu công tác</option>
                            <option value="2">Lệnh công tác</option>
                        </select>
                    </div>
                </div>
                <hr class="mt-md mb-md">
                <div class="row show-grid">
                    <div class="col-md-2">
                        <span>Từ ngày: &nbsp;</span>
                        <input id="GioBd" type="text" placeholder="Thời gian bắt đầu">
                    </div>
                    <div class="col-md-2" id="content-denngay">
                        <span>Đến ngày: </span>
                        <input id="GioKt" type="text" placeholder="Thời gian kết thúc" onchange="end_chage()">
                    </div>
                    <div class="col-md-2">
                        <span> &nbsp; Cắt điện: &nbsp;</span>

                        <select class="form-control" id="cmbTTPhienCatDien" onchange="ttphiencatdien_change(this)">
                            <option value="0">Tất cả</option>

                            @if (ViewBag.ThuocTinhPhienCatDien != null)
                            {
                                var list = (List<ECP_V2.DataAccess.plv_ThuocTinhPhien>)ViewBag.ThuocTinhPhienCatDien;

                                foreach (var item in list)
                                {
                                    <option value="@item.Id">@item.TenThuocTinh</option>
                                }
                            }

                        </select>
                    </div>
                    <div class="col-md-2">
                        <span> &nbsp; Tiếp địa: &nbsp;</span>

                        <select class="form-control" id="cmbTTPhienTiepDia" onchange="ttphientiepdia_change(this)">
                            <option value="0">Tất cả</option>

                            @if (ViewBag.ThuocTinhPhienTiepDia != null)
                            {
                                var list = (List<ECP_V2.DataAccess.plv_ThuocTinhPhien>)ViewBag.ThuocTinhPhienTiepDia;

                                foreach (var item in list)
                                {
                                    <option value="@item.Id">@item.TenThuocTinh</option>
                                }
                            }

                        </select>
                    </div>
                    <div class="col-md-2">
                        <span> &nbsp; Khác: &nbsp;</span>

                        <select class="form-control" id="cmbTTPhienKhac" onchange="ttphienkhac_change(this)">
                            <option value="0">Tất cả</option>

                            @if (ViewBag.ThuocTinhPhien5 != null)
                            {
                                var list = (List<ECP_V2.DataAccess.plv_ThuocTinhPhien>)ViewBag.ThuocTinhPhien5;

                                foreach (var item in list)
                                {
                                    <option value="@item.Id">@item.TenThuocTinh</option>
                                }
                            }

                        </select>
                    </div>
                    <div class="col-md-2">
                    </div>
                </div>
                <hr class="mt-md mb-md">
                @*<div class="row show-grid">
                        <div class="col-md-6">
                            @{ Html.RenderAction("GetDropDownListPageSize", "SystemConfig"); }

                            <input type="checkbox" name="txtChuyenNPC" id="txtChuyenNPC" /> Công việc chuyển Tổng công ty

                        </div>

                    </div>*@
                @*<hr class="mt-md mb-md">*@


                @if (User.IsInRole("DuyetViec"))
                {
                    <div class="row show-grid">

                        <div class="col-md-5" style="margin-left:10px">
                            <span>Loại công việc: &nbsp;</span>
                            <br />
                            <select class="form-control" id="cmbLoaiCongViec" onchange="loaicv_change(this)" data-placeholder="Chọn loại công việc..." multiple>
                                @if (ViewBag.ListLoaiCongViec != null)
                                {
                                    var listLCV = (List<ECP_V2.DataAccess.d_LoaiCongViec>)ViewBag.ListLoaiCongViec;

                                    foreach (var item in listLCV)
                                    {
                                        <option value="@item.Id">@item.TenLoaiCongViec</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="col-md-2" style="margin-left:10px">
                            <span>Trạng thái: &nbsp;</span>
                            <br />
                            <select class="form-control" id="cmbTTPhien" onchange="ttphien_change(this)">
                                <option value="0">Tất cả</option>
                                @if (ViewBag.ListTTPhien != null)
                                {
                                    var listTTPhien = (List<ECP_V2.DataAccess.plv_TrangThaiPhien>)ViewBag.ListTTPhien;

                                    foreach (var item in listTTPhien)
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="col-md-2" style="margin-left:10px">
                            <span>Duyệt Tổng công ty: &nbsp;</span>
                            <br />
                            <select class="form-control" id="cmbDuyetNPC" @*onchange="cmbDuyetNPC_change(this)"*@>
                                <option value="-1">Tất cả</option>
                                <option value="0">Chưa chuyển Tổng công ty</option>
                                <option value="1">Đã chuyển Tổng công ty</option>
                            </select>
                        </div>
                        <div class="col-md-2" style="margin-left:10px">
                            <span>Phiếu ký: &nbsp;</span>
                            <br />
                            <select class="form-control" id="cmdPhieuKy" @*onchange="cmbDuyetNPC_change(this)"*@>
                                <option value="-1">Tất cả</option>
                                <option value="0">Hoàn thiện phiếu ký</option>
                            </select>
                        </div>

                        @*<div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimCapPhieuLenhAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="CapSoPhieuLenhAll">
                                    <i class="fa fa-check-circle"></i> &nbsp; Cấp Số Phiếu/Lệnh công tác
                                </a>
                            </div>*@

                        @*<div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimDuyetPhieuLenhAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetAllPhieuLenh">
                                    <i class="fa fa-check-circle"></i> &nbsp; Duyệt Phiếu/Lệnh công tác
                                </a>
                            </div>*@
                        @if (User.IsInRole("NguoiCapSoPhieu"))
                        {
                            @*<div class="col-md-2" style="margin-left:10px">
                                    <br />
                                    <a href="#modalAnimCapSoPhieuLenhAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="CapSoAllPhieuLenh">
                                        <i class="fa fa-check-circle"></i> &nbsp; Cấp số Phiếu/Lệnh công tác
                                    </a>
                                </div>*@
                        }

                        @*<div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimDuyetAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetAll">
                                    <i class="fa fa-check-circle"></i> &nbsp; Duyệt lịch làm việc
                                </a>
                            </div>*@

                        @if (User.IsInRole("DuyetNPC"))
                        {
                            <div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimGuiNPCAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetNPC">
                                    <i class="fa fa-check-circle"></i> &nbsp; Gửi công việc Tổng công ty
                                </a>
                            </div>
                        }

                        @*<div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimDeleteMultiple" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="XoaDanhSach">
                                    <i class="fa fa-check-circle"></i> &nbsp; Xóa danh sách
                                </a>
                            </div>*@

                    </div>
                    @*<div class="col-md-2">
                            <a href="#modalAnimGuiNPCAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetAll">
                                <i class="fa fa-sen-circle"></i> &nbsp; Gửi công việc Tổng công ty
                            </a>
                        </div>*@
                    @*<div class="col-md-2">
                        </div>
                        <div class="col-md-2">
                        </div>
                        <div class="col-md-2">
                        </div>*@

                    @*<div class="col-md-6" style="float: right;">
                            <div id="datatable-default_filter" class="dataTables_filter">
                                <label>
                                    <input class="form-control" type="text" placeholder="Tìm kiếm..." id="txtSearch" onkeypress="txtSearch_onKeyPress(event,this)"
                                           onkeyup="txtSearch_onkeyup(event,this)" />
                                </label>
                            </div>
                        </div>*@

                }
                else
                {
                    <div class="row show-grid">

                        <div class="col-md-5" style="margin-left:10px">
                            <span>Loại công việc: &nbsp;</span>
                            <br />
                            <select class="form-control" id="cmbLoaiCongViec" onchange="loaicv_change(this)" data-placeholder="Chọn loại công việc..." multiple>
                                @if (ViewBag.ListLoaiCongViec != null)
                                {
                                    var listLCV = (List<ECP_V2.DataAccess.d_LoaiCongViec>)ViewBag.ListLoaiCongViec;

                                    foreach (var item in listLCV)
                                    {
                                        <option value="@item.Id">@item.TenLoaiCongViec</option>
                                    }
                                }
                            </select>
                        </div>

                        @if (User.IsInRole("Manager") || User.IsInRole("Leader") || User.IsInRole("Admin") || User.IsInRole("Master") || User.IsInRole("AdminDonVi"))
                        {
                            <div class="col-md-2" style="margin-left:10px">
                                <span>Trạng thái: &nbsp;</span>
                                <br />
                                <select class="form-control" id="cmbTTPhien" onchange="ttphien_change(this)">
                                    <option value="0">Tất cả</option>
                                    @if (ViewBag.ListTTPhien != null)
                                    {
                                        var listTTPhien = (List<ECP_V2.DataAccess.plv_TrangThaiPhien>)ViewBag.ListTTPhien;

                                        foreach (var item in listTTPhien)
                                        {
                                            <option value="@item.Id">@item.Name</option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="col-md-2" style="margin-left:10px">
                                <span>Duyệt Tổng công ty: &nbsp;</span>
                                <br />
                                <select class="form-control" id="cmbDuyetNPC" @*onchange="cmbDuyetNPC_change(this)"*@>
                                    <option value="-1">Tất cả</option>
                                    <option value="0">Chưa chuyển Tổng công ty</option>
                                    <option value="1">Đã chuyển Tổng công ty</option>
                                </select>
                            </div>

                        }

                        @if (User.IsInRole("DuyetNPC"))
                        {
                            <div class="col-md-2" style="margin-left:10px">
                                <br />
                                <a href="#modalAnimGuiNPCAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetNPC">
                                    <i class="fa fa-check-circle"></i> &nbsp; Gửi công việc Tổng công ty
                                </a>
                            </div>
                        }

                        <div class="col-md-2" style="margin-left:10px">
                            <br />
                            <a href="#modalAnimDeleteMultiple" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="DuyetNPC">
                                <i class="fa fa-check-circle"></i> &nbsp; Xóa danh sách
                            </a>
                        </div>

                        @if (User.IsInRole("NguoiCapSoPhieu"))
                        {
                            @*<div class="col-md-2" style="margin-left:10px">
                                    <br />
                                    <a href="#modalAnimCapSoPhieuLenhAll" class="mb-xs mt-xs mr-xs btn btn-primary" style="cursor:pointer;padding: 3px 9px;" id="CapSoAllPhieuLenh">
                                        <i class="fa fa-check-circle"></i> &nbsp; Cấp số Phiếu/Lệnh công tác
                                    </a>
                                </div>*@
                        }

                        @*<hr class="mt-md mb-md">*@


                    </div>
                }

                @*<div class="row show-grid" style="text-align">
                    <div class="col-md-4" style="float: right;">
                        <div id="datatable-default_filter" class="dataTables_filter">
                            <label>
                                <input class="form-control" type="text" placeholder="Tìm kiếm..." id="txtSearch" onkeypress="txtSearch_onKeyPress(event,this)"
                                       onkeyup="txtSearch_onkeyup(event,this)" />
                            </label>
                        </div>
                    </div>
                    </div>*@


                <div class="listRolesName list" style="margin-top: 5px;">
                    @{Html.RenderAction("ListPhieuCongTac", "PhienLV", new
                        {
                            page = 1,
                            pageSize = @*(Session["drlPageSize"] != null) ? int.Parse(Session["drlPageSize"].ToString()) :*@ /**/                                                                                                                                                                                                                           500,
filter = "",
tcphien = 0,
catdien = 0,
tiepdia = 0,
khac = 0,
DateFrom = ViewBag.TuNgay,
DateTo = ViewBag.DenNgay,
DonViId = (ViewBag.DonViID != null) ? ViewBag.DonViID : Session["DonViID"].ToString(),
ttPhien = 0,
chuyenNPC = -1
});
                    }
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .container-fluid {
        padding-left: 0;
        padding-right: 0;
    }

    .content-body {
        padding: 5px;
    }
</style>

@section JavaScriptOnePgae{
    @Scripts.Render("~/Scripts/jquery-unified-export-file-1.0.min.js")
    <script type="text/javascript">

        var IdDetail = 0, IdDuyet = 0, IdSign = 0;
        var IdDelete = 0;
        var IdUpdateVuaTao = 0;
        var IdUpdateSoPhieu = 0;
        var NoiDungDelete = 0;
        var IdPCT = 0;

        $(function () {

            $('#cmbLoaiCongViec').chosen({ width: "100%" });

            let strTemp = $('#listLCV').val();
            if (strTemp != undefined && strTemp != null && strTemp != "") {
                let listLCV = strTemp.split(",");

                $('#cmbLoaiCongViec').val(listLCV).trigger('chosen:updated');
                Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
            }


            //Menu Collapsed Layout
            $('html').addClass('sidebar-left-collapsed');

            @*var tuNgay = kendo.toString(kendo.parseDate('@DateTime.Now', 'dd/MM/yyyy'), 'dd/MM/yyyy');
            var start = $("#GioBd").kendoDatePicker({
                format: 'dd/MM/yyyy',
            }).data("kendoDatePicker").value(tuNgay);

            var denNgay = kendo.toString(kendo.parseDate('@DateTime.Now', 'dd/MM/yyyy'), 'dd/MM/yyyy');
            var end = $("#GioKt").kendoDatePicker({
                format: 'dd/MM/yyyy',
                change: end_chage
            }).data("kendoDatePicker").value(denNgay);*@

            var yNgay = '@(ViewBag.TuNgay != null?ViewBag.TuNgay : DateTime.Now)'.split(' ')[0];
            var start = $("#GioBd").datepicker({
                dateFormat: 'dd/mm/yy'
            }).val(yNgay);

            var xNgay = '@(ViewBag.DenNgay != null?ViewBag.DenNgay : DateTime.Now)'.split(' ')[0];
            var end = $("#GioKt").datepicker({
                dateFormat: 'dd/mm/yy',
                onSelect: function () {
                    end_chage();
                }
            }).val(xNgay);

            $('#DuyetAllPhieuLenh').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
            });

             $('#CapSoAllPhieuLenh').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
                });

            //khai bao Popup cho nut duyet
            $('#DuyetAll').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
                });

            $('#DuyetNPC').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
                });

            $('#XoaDanhSach').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
            });

            $('a#btnTongHopBaoCaoCuoiNgay').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
                ModalConfirmTongHop();
            });

            //$("#txtNgayTongHop").kendoDatePicker({
            //    format: 'dd/MM/yyyy',
            //    value: new Date()
            //}).data("kendoDatePicker");

            $("#txtNgayTongHop").datepicker({
                dateFormat: 'dd/mm/yy'
            }).val(yNgay);

            $('a#btnTongHopBaoCaoCuoiNgayAlert').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
            });


            $('#cmbDuyetNPC').change(function () {
                Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $(this).val(), $('#cmdPhieuKy').val());
            });

            $('#cmdPhieuKy').change(function () {
                Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $(this).val(), $('#cmdPhieuKy').val());
            });

            @if(ViewBag.DonViID != null)
            {
                <text>
            var dvElement = document.getElementById('cmbDonViID');
            $('#cmbDonViID').val('@ViewBag.DonViID');
            donvi_change(dvElement);
                </text>

            }
        });

        function end_chage() {
            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());
        }

        function donvi_change(el) {

            LoadPhongBanByDonVi(el.value);

            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), el.value, $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());
        }

        function tcphien_change(el) {

            Paging(1, 500, $('#txtSearch').val(), el.value, $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());
        }

        function ttphien_change(el) {

            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());

        }

         function loaicv_change(el) {

             Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());

        }


        function loaiphieu_change(el) {

            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());

        }

        function ttphiencatdien_change(el) {

            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), el.value, $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());

        }

        function ttphientiepdia_change(el) {
            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), el.value, $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());

        }

        function ttphienkhac_change(el) {

            Paging(1, 500, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), el.value, $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val(), $('#cmdPhieuKy').val());
        }

        function Paging(page, pageSize, filter, tcphien, catdien, tiepdia, khac, DateFrom, DateTo, DonViId, PhongBanId, chuyenNPC, phieuky) {
            if (filter.length) {
                if ($("#cmbLoaiTimKiemText").val() == "0") {
                    filter = "0:" + filter;
                } else {
                    filter = "1:" + filter;
                }
            }
            //console.log("filter: " + filter);
            //loading('Đang tải dữ liệu...', 1);
            //$("#preloader").unbind("click");
            //$('#preloader').click(function () {
            //    ///unloading();
            //})
            var ttPhien = 0;
            var cbTTPhienSelect = $('#cmbTTPhien').val();
            var userRoleDuyet = '@(Request.IsAuthenticated && User.IsInRole("DuyetViec")) ? "true" : "false")';
            if (userRoleDuyet && cbTTPhienSelect != "") {
                ttPhien = cbTTPhienSelect;
            }
            else {

                ttPhien = 0;
            }

            if (typeof (ttPhien) === 'undefined') {
                ttPhien = 0;
            }

            var lcv = $('#cmbLoaiCongViec').val();

            var scriptUrl = "/Admin/PhienLV/ListPhieuCongTac";
            $.ajax({
                url: scriptUrl,
                data: {
                    page: page,
                    pageSize: pageSize,
                    filter: filter,
                    tcphien: tcphien,
                    catdien: catdien,
                    tiepdia: tiepdia,
                    khac: khac,
                    DateFrom: DateFrom,
                    DateTo: DateTo,

                    DonViId: DonViId,
                    PhongBanId: PhongBanId,
                    ttPhien: ttPhien,
                    chuyenNPC: chuyenNPC,
                    phieuky: $('#cmdPhieuKy').val(),
                    loaiPhieuLenh: $("#cmbLoaiPhieu").val(),
                    loaiCV: lcv != null ? lcv.join(',') : null
                },
                type: 'GET',
                dataType: 'html',
                async: false,
                success: function (data) {
                    $(".list").html("");
                    $(".list").html(data);

                    $("#drlPageSize").val(pageSize);
                    $("#txtSearch").val(filter.replace("0:", "").replace("1:", ""));

                    $('a.nhaysophieu').magnificPopup({
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,
                overflowY: 'auto',
                closeBtnInside: true,
                preloader: false,
                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in',
                modal: true
            }).click(function () {
                $("#spintTongSoPhieuNhay").val(1);
                $("#inputLoaiPCT").val($(this).attr("id").split("_")[1]);

            });
                    unloading();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    unloading();
                    alert("Có lỗi, hãy kiểm tra kết nối internet.");
                }
            });
            unloading();
        }

        function pagelength_change(el) {

            Paging(1, el.value, $('#txtSearch').val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

        }

        function txtSearch_onKeyPress(e, el) {
            var key;
            if (window.event)
                key = window.event.keyCode;     //IE
            else
                key = e.which;     //firefox

            if (key == 13) {

                Paging(1, 500, el.value, $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

            }
        }

        function txtSearch_onkeyup(e, el) {
            if (el.value == '') {
                Paging(1, 500, el.value, $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

            }
        }

        function ModalDismissDetail() {
            $.magnificPopup.close();
        }

        function ModalDismissComment() {
            $.magnificPopup.close();
        }

        function ExportBSModalDismiss() {
            $.magnificPopup.close();
        }

        function DuyetModalDismiss() {
            $.magnificPopup.close();
        }

        function DeleteMultipleModalDismiss() {
            $.magnificPopup.close();
        }

        function NPCModalDismiss() {
            $.magnificPopup.close();
        }

        function DuyetAllModalDismiss() {
            $.magnificPopup.close();
        }

        function GuiNPCAllModalDismiss() {
            $.magnificPopup.close();
        }

        function DetailPhienLv(PhienLvId) {

            loading('Đang tải dữ liệu...', 1);
            $("#preloader").unbind("click");
            $('#preloader').click(function () {
                unloading();
            })

            $.ajax({
                type: "GET",
                url: '/Admin/PhienLV/DetailPhienLv?Id=' + PhienLvId,
                success: function (json) {

                    $('#modalAnimDetail .modal-wrapper').html('');
                    $('#modalAnimDetail .modal-wrapper').html(json);
                    $('a.chi-tiet-phien-lv').prop('href', '/Admin/PhienLV/ChiTietPhienLV/' + PhienLvId);

                    unloading();
                }
            });
            unloading();
        }

        function DetailPhieuCongTac(PhienLvId) {

            loading('Đang tải dữ liệu...', 1);
            $("#preloader").unbind("click");
            $('#preloader').click(function () {
                unloading();
            })

            $.ajax({
                type: "GET",
                url: '/Admin/PhienLV/DetailPhieuCongTac?Id=' + PhienLvId,
                success: function (json) {

                    $('#modalAnimDetailPCT .modal-wrapper').html('');
                    $('#modalAnimDetailPCT .modal-wrapper').html(json);

                    unloading();
                }
            });
            unloading();
        }

        function AddComment(PhienLvId) {

            loading('Đang tải dữ liệu...', 1);
            $("#preloader").unbind("click");
            $('#preloader').click(function () {
                unloading();
            })

            $.ajax({
                type: "GET",
                url: '/Admin/PhienLV/AddComment?Id=' + PhienLvId,
                success: function (json) {

                    $('#modalAnimComment .modal-wrapper').html('');
                    $('#modalAnimComment .modal-wrapper').html(json);

                    $.validator.unobtrusive.parse($('#AddComment'));
                    $('#AddComment').submit(function () {
                        // inside event callbacks 'this' is the DOM element so we first
                        // wrap it in a jQuery object and then invoke ajaxSubmit
                        if ($(this).valid())
                            $(this).ajaxSubmit(options4);

                        // !!! Important !!!
                        // always return false to prevent standard browser submit and page navigation
                        return false;
                    });

                    unloading();
                }
            });
            unloading();
        }

        //View biên bản khảo sát và PATC
        $("#fileBBKS").change(function () {
            var fileBase64 = getBase64(document.getElementById('fileBBKS').files[0]);

            var objbuilder = '';

            objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');

            objbuilder += (fileBase64);
            objbuilder += ('" type="application/pdf" class="internal">');
            objbuilder += ('<embed src="data:application/pdf;base64,');
            objbuilder += (fileBase64);
            objbuilder += ('" type="application/pdf"  />');
            objbuilder += ('</object>');

            $("#contentBBKS").append(objbuilder);

        });

        //Hàm load form xác nhận ký
        function ConfirmSignPhieu(idsign) {

        }

        //Gọi hàm upload file BBKS
        function onUploadBBKS() {
            var formData = new FormData();
            var file = document.getElementById("fileBBKS").files[0];
            var IdSign = $('#hdIdphien').val();
            formData.append("fileBBKS", file);
            formData.append("Id", IdSign);
            formData.append("Loaibb", 0);
            $.ajax({
                type: "POST",
                url: '/Admin/PhienLV/onUploadBBKS',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    if (data == "") {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công',
                            type: 'success'
                        });


                        //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                    }

                    }

            });
        }

        //Gọi hàm upload file BBKS
        function onUploadPATC() {
            var formData = new FormData();
            var file = document.getElementById("filePATC").files[0];
            var IdSign = $('#hdIdphien').val();
            formData.append("fileBBKS", file);
            formData.append("Id", IdSign);
            formData.append("Loaibb", 1);
            $.ajax({
                type: "POST",
                url: '/Admin/PhienLV/onUploadBBKS',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    if (data == "") {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công',
                            type: 'success'
                        });


                        //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                    }

                }

            });
        }

        //Gọi hàm ký số BBKS
        function onSignBBKS() {
            var formData = new FormData();
            var file = document.getElementById("fileBBKS").files[0];
            var IdSign = $('#hdIdphien').val();
            formData.append("fileBBKS", file);
            formData.append("Id", IdSign);
            formData.append("Loaibb", 0);
                $.ajax({
                    type: "POST",
                    url: '/Admin/PhienLV/onSignBBKSAsync',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data == "") {
                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Ký số thành công',
                                type: 'success'
                            });


                            //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                        }
                        else if (data == "Chưa cấp số phiếu không được Ký") {
                            $.magnificPopup.close({
                                items: {
                                    src: '#modalAnimKyso'
                                }
                            });

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Chưa cấp số phiếu không được Ký!',
                                type: 'error'
                            });
                        } else if (data == "Chưa được ký bước cuối!") {
                            $.magnificPopup.close({
                                items: {
                                    src: '#modalAnimKyso'
                                }
                            });

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Chưa được ký kết thúc!',
                                type: 'error'
                            });
                        } else if (data == "NOT EVNCA") {
                            $.magnificPopup.close({
                                items: {
                                    src: '#modalAnimKyso'
                                }
                            });


                        } else if (data == "Phiếu đã được ký") {
                            $.magnificPopup.close({
                                items: {
                                    src: '#modalPATC'
                                }
                            });

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Phương án thi công đã được ký, không thể ký tiếp.',
                                type: 'error'
                            });


                        } else if (data == "Chưa có file") {
                            $.magnificPopup.close({
                                items: {
                                    src: '#modalPATC'
                                }
                            });

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Người dùng chọn file Phương án thi công để ký.',
                                type: 'error'
                            });

                        } else {

                            $.magnificPopup.close({
                                items: {
                                    src: '#modalAnimKyso'
                                }
                            });

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Ký số thành công',
                                type: 'success'
                            });
                        }

                    }

                });
        }

        //Gọi hàm ký số PATC
        function onSignPATC() {
            var formData = new FormData();
            var file = document.getElementById("filePATC").files[0];
            var IdSign = $('#hdIdphienPatc').val();
            formData.append("filePATC", file);
            formData.append("Id", IdSign);
            formData.append("Loaibb", 1);
            $.ajax({
                type: "POST",
                url: '/Admin/PhienLV/onSignBBKSAsync',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    if (data == "") {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công',
                            type: 'success'
                        });


                        //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                    }
                    else if (data == "Chưa cấp số phiếu không được Ký") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Chưa cấp số phiếu không được Ký!',
                            type: 'error'
                        });
                    } else if (data == "Chưa được ký bước cuối!") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Chưa được ký kết thúc!',
                            type: 'error'
                        });
                    } else if (data == "NOT EVNCA") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });


                    } else if (data == "Phiếu đã được ký") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalPATC'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Phương án thi công đã được ký, không thể ký tiếp.',
                            type: 'error'
                        });


                    } else if (data == "Chưa có file") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalPATC'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Người dùng chọn file Phương án thi công để ký.',
                            type: 'error'
                        });

                    } else {

                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công',
                            type: 'success'
                        });
                    }

                }

            });
        }


        //Gọi hàm ký số
        function CallSignPhieu(IdSign) {
            //Kiểm tra xem phiếu đã cấp số chưa mới cho ký.

            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/CallSignPhieu',
                data:
                {
                    "Id": IdSign
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    if (data == "") {
                    console.log("chekc data1", data)
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công',
                            type: 'success'
                        });


                        //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                    }
                    else if (data == "Chưa cấp số phiếu không được Ký") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Chưa cấp số phiếu không được Ký!',
                            type: 'error'
                        });
                    } else if (data == "Chưa được ký bước cuối!") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Chưa được ký kết thúc!',
                            type: 'error'
                        });
                    } else if (data == "NOT EVNCA") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Tài khoản chưa được cấp EVNCA',
                            type: 'error'
                        });
                    } else if (data == "Chưa ký tại hiện trường") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Chưa ký tại hiện trường!',
                            type: 'error'
                        });
                    } else if (data == "Có lỗi ký số") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Có lỗi ký số!',
                            type: 'error'
                        });
                    }
                    else if (data == "Hoàn thiện bước ký") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Phiếu đã hoàn thiện ký!',
                            type: 'error'
                        });
                    }else if (data == "Not permission") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Người dùng không có quyền ký với phiếu này!',
                            type: 'error'
                        });
                    } else if (data == "OK") {
                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Ký số thành công!',
                            type: 'success'
                        });
                    } else
                       {
                        //var json = JSON.parse(data.Result);
                        //Convert Base64 string to Byte Array.
                        //var bytes = Base64ToBytes(data);

                        ////Convert Byte Array to BLOB.
                        //var blob = new Blob([bytes], { type: "application/octetstream" });
                        //var filename = "xxxxx.pdf";
                        ////Check the Browser type and download the File.
                        //var isIE = false || !!document.documentMode;
                        //if (isIE) {
                        //    window.navigator.msSaveBlob(blob, filename);
                        //} else {
                        //    var url = window.URL || window.webkitURL;
                        //    link = url.createObjectURL(blob);
                        //    var a = $("<a />");
                        //    a.attr("download", filename);
                        //    a.attr("href", link);
                        //    $("body").append(a);
                        //    a[0].click();
                        //    $("body").remove(a);
                        //}

                        $.magnificPopup.close({
                            items: {
                                src: '#modalAnimKyso'
                            }
                        });

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Lỗi ký số',
                            type: 'error'
                        });
                    }

                }

            });
        }

        function Base64ToBytes(base64) {
            var s = window.atob(base64);
            var bytes = new Uint8Array(s.length);
            for (var i = 0; i < s.length; i++) {
                bytes[i] = s.charCodeAt(i);
            }
            return bytes;
    };

    function getBase64(file) {
        var reader = new FileReader();
        reader.readAsDataURL(file);
        if (reader.result != null) {
            return reader.result.replace('data:application/pdf;base64,', '');
        }

    }

    function ViewFileSignInForm(id, buocky) {

        //Kiểm tra xem bước mấy
        if (buocky == 0) {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/ViewFileNoSign',
                data:
                {
                    "idphien": id
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    //unloading();
                    $("#showFileKyso").empty();
                    if (data == "") {

                    }
                    else {
                        var objbuilder = '';

                        objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');

                        objbuilder += (data);
                        objbuilder += ('" type="application/pdf" class="internal">');
                        objbuilder += ('<embed src="data:application/pdf;base64,');
                        objbuilder += (data);
                        objbuilder += ('" type="application/pdf"  />');
                        objbuilder += ('</object>');

                        $("#showFileKyso").append(objbuilder);

                    }

                }

            });
        }

        if (buocky > 0) {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/ViewFileSign',
                data:
                {
                    "Id": id
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    $("#showFileKyso").empty();
                    if (data == "") {
                        $("#showFileKyso").append("Chưa ký số");
                    }
                    else {
                        var arrdata = data.split(' | ');
                        $('#numberFile').val(arrdata.length);
                        var objbuilder = '';
                        for (let i = 0; i < arrdata.length; i++) {
                            if (i == 0) {
                                objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');
                            } else {
                                objbuilder += ('<object width="100%" id="obj' + i + '" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                            }

                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf" class="internal">');
                            objbuilder += ('<embed src="data:application/pdf;base64,');
                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf"  />');
                            objbuilder += ('</object>');
                        }

                        $("#showFileKyso").append(objbuilder);

                    }

                }

            });
        }
    }

        function ViewFileSign(id) {
            //Thử view qua dialog;
            //var dialog = '<div id="pdfDialog" title="xxxxxx">' +
            //    '<label>Page: </label><label id="pageNum"></label><label> of </label><label id="pageLength"></label>' +
            //    '<canvas id="pdfview"></canvas>' +
            //    '</div>';
            //$("div[id=pdfDialog]").remove();
            //$(document.body).append(dialog);
            //$("#pdfDialog").dialog();

            //var base = 'JVBERi0xLjcKCjEgMCBvYmogICUgZW50cnkgcG9pbnQKPDwKICAvVHlwZSAvQ2F0YWxvZwog' +
            //    'IC9QYWdlcyAyIDAgUgo+PgplbmRvYmoKCjIgMCBvYmoKPDwKICAvVHlwZSAvUGFnZXMKICAv' +
            //    'TWVkaWFCb3ggWyAwIDAgMjAwIDIwMCBdCiAgL0NvdW50IDEKICAvS2lkcyBbIDMgMCBSIF0K' +
            //    'Pj4KZW5kb2JqCgozIDAgb2JqCjw8CiAgL1R5cGUgL1BhZ2UKICAvUGFyZW50IDIgMCBSCiAg' +
            //    'L1Jlc291cmNlcyA8PAogICAgL0ZvbnQgPDwKICAgICAgL0YxIDQgMCBSIAogICAgPj4KICA+' +
            //    'PgogIC9Db250ZW50cyA1IDAgUgo+PgplbmRvYmoKCjQgMCBvYmoKPDwKICAvVHlwZSAvRm9u' +
            //    'dAogIC9TdWJ0eXBlIC9UeXBlMQogIC9CYXNlRm9udCAvVGltZXMtUm9tYW4KPj4KZW5kb2Jq' +
            //    'Cgo1IDAgb2JqICAlIHBhZ2UgY29udGVudAo8PAogIC9MZW5ndGggNDQKPj4Kc3RyZWFtCkJU' +
            //    'CjcwIDUwIFRECi9GMSAxMiBUZgooSGVsbG8sIHdvcmxkISkgVGoKRVQKZW5kc3RyZWFtCmVu' +
            //    'ZG9iagoKeHJlZgowIDYKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMDEwIDAwMDAwIG4g' +
            //    'CjAwMDAwMDAwNzkgMDAwMDAgbiAKMDAwMDAwMDE3MyAwMDAwMCBuIAowMDAwMDAwMzAxIDAw' +
            //    'MDAwIG4gCjAwMDAwMDAzODAgMDAwMDAgbiAKdHJhaWxlcgo8PAogIC9TaXplIDYKICAvUm9v' +
            //    'dCAxIDAgUgo+PgpzdGFydHhyZWYKNDkyCiUlRU9G';

            //easyPDF(base, "jQueryScript.Net");
            //$('#modalViewKyso').magnificPopup({
            //    type: 'iframe',
            //    alignTop: true,
            //    overflowY: 'scroll',
            //    closeOnContentClick: false
            //});
            //$.magnificPopup.open({
            //    items: {
            //        src: '#modalViewKyso'
            //    }, mainClass: 'mfp-fullscreen'
            //});

            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/ViewFileSign',
                data:
                {
                    "Id": id
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    $("#contentKyso").empty();
                    if (data == "" || data == " |  | ") {
                        $("#contentKyso").append("Chưa ký số");

                        //new PNotify({
                        //    title: 'Thông báo!',
                        //    text: 'Ký số thành công',
                        //    type: 'success'
                        //});


                        //Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                    }
                    else {
                        //var json = JSON.parse(data.Result);
                        //Convert Base64 string to Byte Array.
                        //var bytes = Base64ToBytes(data);

                        ////Convert Byte Array to BLOB.
                        //var blob = new Blob([bytes], { type: "application/octetstream" });
                        //var filename = generateRandomString(12) + ".pdf";
                        ////Check the Browser type and download the File.
                        //var isIE = false || !!document.documentMode;
                        //if (isIE) {
                        //    window.navigator.msSaveBlob(blob, filename);
                        //} else {
                        //    var url = window.URL || window.webkitURL;
                        //    link = url.createObjectURL(blob);
                        //    var a = $("<a />");
                        //    a.attr("download", filename);
                        //    a.attr("href", link);
                        //    $("body").append(a);
                        //    a[0].click();
                        //    $("body").remove(a);
                        //}
                        var arrdata = data.split(' | ');
                        $('#numberFile').val(arrdata.length);
                        var objbuilder = '';
                        for (let i = 0; i < arrdata.length; i++) {
                            if (i == 0) {
                                objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');
                            } else {
                                objbuilder += ('<object width="100%" id="obj' + i + '" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                            }

                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf" class="internal">');
                            objbuilder += ('<embed src="data:application/pdf;base64,');
                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf"  />');
                            objbuilder += ('</object>');
                        }


                        //objbuilder += ('<object width="100%" id="obj1" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                        //objbuilder += (arrdata[1]);
                        //objbuilder += ('" type="application/pdf" class="internal">');
                        //objbuilder += ('<embed src="data:application/pdf;base64,');
                        //objbuilder += (arrdata[1]);
                        //objbuilder += ('" type="application/pdf"  />');
                        //objbuilder += ('</object>');

                        //objbuilder += ('<object width="100%" id="obj2" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                        //objbuilder += (arrdata[2]);
                        //objbuilder += ('" type="application/pdf" class="internal">');
                        //objbuilder += ('<embed src="data:application/pdf;base64,');
                        //objbuilder += (arrdata[2]);
                        //objbuilder += ('" type="application/pdf"  />');
                        //objbuilder += ('</object>');



                        $("#contentKyso").append(objbuilder);

                    }

                }

            });
        }

        //View file sign BBKS
        function ViewFileSignBBKS(id) {
            $("#contentBBKS").empty();
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/ViewFileSignBBKSPATC',
                data:
                {
                    "id": id,
                    "loaibb": 0,
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();

                    if (data == "NOFILE") {

                    }
                    else {
                        var arrdata = data.split(' | ');
                        //$('#numberFile').val(arrdata.length);
                        var objbuilder = '';
                        for (let i = 0; i < arrdata.length; i++) {
                            if (i == 0) {
                                objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');
                            } else {
                                objbuilder += ('<object width="100%" id="obj' + i + '" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                            }

                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf" class="internal">');
                            objbuilder += ('<embed src="data:application/pdf;base64,');
                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf"  />');
                            objbuilder += ('</object>');
                        }


                        $("#contentBBKS").append(objbuilder);

                    }

                }

            });
        }

        //View file sign PATC
        function ViewFileSignPATC(id) {
            $("#contentPATC").empty();
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/ViewFileSignBBKSPATC',
                data:
                {
                    "id": id,
                    "loaibb": 1,
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();

                    if (data == "") {

                    }
                    else {
                        var arrdata = data.split(' | ');
                        //$('#numberFile').val(arrdata.length);
                        var objbuilder = '';
                        for (let i = 0; i < arrdata.length; i++) {
                            if (i == 0) {
                                objbuilder += ('<object width="100%" id="obj' + i + '" height="100%" data = "data:application/pdf;base64,');
                            } else {
                                objbuilder += ('<object width="100%" id="obj' + i + '" style="display:none;" height="100%" data = "data:application/pdf;base64,');
                            }

                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf" class="internal">');
                            objbuilder += ('<embed src="data:application/pdf;base64,');
                            objbuilder += (arrdata[i]);
                            objbuilder += ('" type="application/pdf"  />');
                            objbuilder += ('</object>');
                        }


                        $("#contentPATC").append(objbuilder);

                    }

                }

            });
        }

        function generateRandomString(length) {

            var text = "";
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

            for (var i = 0; i < length; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }

            return text;
        }

        var options4 = {
            // target element(s) to be updated with server response
            beforeSubmit: showRequest4,  // pre-submit callback
            success: showResponse4,  // post-submit callback
            dataType: 'json',
            resetForm: false
        };
        function showRequest4(formData, jqForm, options) {
            loading("Đang xử lý...", 1);
            $("#preloader").unbind("click");
            $('#preloader').click(function () {
                unloading();
            })

            return true;
        }

        function showResponse4(responseText, statusText, xhr, $form) {
            if (responseText == "") {

                new PNotify({
                    title: 'Thông báo!',
                    text: 'Thêm nhận xét thành công',
                    type: 'success'
                });

                //thoat commen
                $.magnificPopup.close();
            }
            else {

                new PNotify({
                    title: 'Có lỗi xảy ra khi thêm nhận xét!',
                    text: 'Lỗi : ' + responseText,
                    type: 'error'
                });
            }

            unloading();
            //Paging(parseInt($("#btnLast").data("sum")),$("#drlPageSize").val(), $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val());

        }

        function ModalConfirmComment(el) {
            $("#AddComment").submit();
        }

        function LoadPhongBanByDonVi(DonViId) {

            $.ajax({
                url: "/Admin/PhienLV/CmbPhongBan",
                data: {
                    DonViId: DonViId
                },
                type: 'GET',
                dataType: 'html',
                async: false,
                success: function (data) {

                    $('#cmbPhongBan').html("");
                    $('#cmbPhongBan').html(data);

                }
            });
        }

        function phongban_change(el) {

            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), el.value, $('#cmbDuyetNPC').val());

        }

        function DuyetModalConfirm() {

            if (IdDuyet != "" ) {

                loading('Đang xử lý...', 1);
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/DuyetPhieuLenh',
                    data:
                    {
                        "Id": IdDuyet
                    },
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {

                        unloading();
                        if (data.success) {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });

                            Paging(parseInt($(".page-number-Current").html()) || 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());


                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'error'
                            });
                        }
                    },
                    error: function (e) {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Không thể duyệt Phiếu công tác này',
                            type: 'error'
                        });
                    }

                });
                unloading();
            }
            else {
                new PNotify({
                    title: 'Thông báo!',
                    text: "Lỗi trạng thái phiếu làm việc!",
                    type: 'error'
                });
            }

            $.magnificPopup.close();
            unloading();

    };

        function HuyDuyetModalConfirm() {

        if (IdDuyet != "") {

            loading('Đang xử lý...', 1);

            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/HuyDuyetPhieuLenh',
                data:
                {
                    "Id": IdDuyet
                },
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    unloading();
                    if (data.success) {

                        new PNotify({
                            title: 'Thông báo!',
                            text: data.responseText,
                            type: 'success'
                        });

                        Paging(parseInt($(".page-number-Current").html()) || 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());


                    }
                    else {

                        new PNotify({
                            title: 'Thông báo!',
                            text: data.responseText,
                            type: 'error'
                        });
                    }
                },
                error: function (e) {
                    new PNotify({
                        title: 'Thông báo!',
                        text: 'Không thể Hủy duyệt Phiếu công tác này',
                        type: 'error'
                    });
                }

            });
        }

        $.magnificPopup.close();
    };

        function ChuyenHoanModalConfirm() {

            if (IdDuyet != "") {

                loading('Đang xử lý...', 1);

                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/ChuyenHoanPhieuLenh',
                    data:
                    {
                        "Id": IdDuyet
                    },
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data.success) {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });

                            Paging(parseInt($(".page-number-Current").html()) || 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());


                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'error'
                            });
                        }
                    },
                    error: function (e) {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Không thể duyệt Phiếu công tác này',
                            type: 'error'
                        });
                        unloading();
                    }

                });
            }

            $.magnificPopup.close();
            unloading();
        };

        function NPCModalConfirm() {

            if (IdDuyet != "") {

                loading('Đang xử lý...', 1);

                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/GuiNPCPhieuLenh',
                    data:
                    {
                        "Id": IdDuyet
                    },
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data.success) {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });

                            Paging(parseInt($(".page-number-Current").html()) || 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'error'
                            });
                        }
                    },
                    error: function (e) {
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Không thể duyệt Phiếu công tác này',
                            type: 'error'
                        });
                    }
                });
            }
            unloading();
            $.magnificPopup.close();
        };

        function DuyetAllPhieuLenhModalConfirm() {

            var items = document.getElementsByClassName('chkbox');


            if (items.length == 0) {
                alert("Vui lòng chọn phiện làm việc !");

            }
            else if (items.length > 0) {
                loading('Đang xử lý...', 1);
                var listId = [];

                for (i = 0; i < items.length; i++) {
                    if (items[i].checked) {
                        listId.push(items[i].value);
                        //sleep(200);
                    }
                }

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/DuyetAllPhieuLenh',
                    data: JSON.stringify({
                        "listId": listId
                    }),
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data != null) {

                            if (data.success) {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'success'
                                });
                            } else {

                                if (data.isDuyet == null) {

                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'error'
                                    });
                                }
                                else {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'warning'
                                    });
                                }
                            }

                            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Duyệt Phiếu công tác không thành công',
                                type: 'error'
                            });
                        }
                    }

                });

            }
            $.magnificPopup.close();
            unloading();

        }

        function DuyetAllModalConfirm() {

            var items = document.getElementsByClassName('chkbox');


            if (items.length == 0) {
                alert("Vui lòng chọn phiên làm việc !");

            }
            else if (items.length > 0) {
                loading('Đang xử lý...', 1);
                var listId = [];

                for (i = 0; i < items.length; i++) {
                    if (items[i].checked) {
                        listId.push(items[i].value);
                        //sleep(200);
                    }
                }

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/DuyetAllPhienLv',
                    data: JSON.stringify({
                        "listId": listId
                    }),
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data != null) {

                            if (data.success) {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'success'
                                });
                            } else {

                                if (data.isDuyet == null) {

                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'error'
                                    });
                                }
                                else {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'warning'
                                    });
                                }
                            }

                            Paging(/*parseInt($(".page-number-Current").html())*/ 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Duyệt Phiếu công tác không thành công',
                                type: 'error'
                            });
                        }
                    }

                });

            }
            $.magnificPopup.close();
            unloading();

        }

        function DeleteMultipleModalConfirm() {

            var items = document.getElementsByClassName('chkbox');


            if (items.length == 0) {
                alert("Vui lòng chọn phiện làm việc !");

            }
            else if (items.length > 0) {
                loading('Đang xử lý...', 1);
                var listId = [];

                for (i = 0; i < items.length; i++) {
                    if (items[i].checked) {
                        listId.push(items[i].value);
                        //sleep(200);
                    }
                }

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/DeleteMultipleLOCK',
                    data: JSON.stringify({
                        "listId": listId
                    }),
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data != null) {

                            $.each(data, function (index, item) {

                                if (item.success) {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: item.responseText,
                                        type: 'success'
                                    });
                                } else {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: 'Lỗi : ' + item.responseText,
                                        type: 'error'
                                    });
                                }

                            });

                            Paging(/*parseInt($(".page-number-Current").html())*/ 1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Xóa Phiếu công tác không thành công',
                                type: 'error'
                            });
                        }
                    }

                });

            }
            $.magnificPopup.close();

        }

        function GuiNPCAllModalConfirm() {

            var items = document.getElementsByClassName('chkbox');


            if (items.length == 0) {
                alert("Vui lòng chọn phiện làm việc !");

            }
            else if (items.length > 0) {

                loading('Đang xử lý...', 1);

                var listId = [];

                for (i = 0; i < items.length; i++) {
                    if (items[i].checked) {
                        listId.push(items[i].value);
                        //sleep(200);
                    }
                }

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/GuiListNPCPhieuLenh',
                    data: JSON.stringify({
                        "listId": listId
                    }),
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data != null) {

                            $.each(data, function (index, item) {

                                if (item.success) {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: item.responseText,
                                        type: 'success'
                                    });
                                } else {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: 'Lỗi : ' + item.responseText,
                                        type: 'error'
                                    });
                                }
                            });

                            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());


                        }
                        else {
                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Duyệt Phiếu công tác Tổng công ty không thành công',
                                type: 'error'
                            });
                        }
                    }

                });

            }
            $.magnificPopup.close();
        }

        function checkall(obj) {

            var items = document.getElementsByClassName("chkbox");

            if ($.trim(obj.text) == "Chọn tất cả") //Đã được chọn
            {
                for (i = 0; i < items.length; i++) {
                    if (!items[i].disabled) {
                        items[i].checked = true;
                    }
                }


                obj.text = "Bỏ chọn tất cả";
            }
            else { //Checkbox chưa được chọn
                for (i = 0; i < items.length; i++)
                    if (!items[i].disabled) {
                        items[i].checked = false;
                    }


                obj.text = "Chọn tất cả";
            }

        }

        function DeleteModalDismiss() {
            $.magnificPopup.close();
        }

        function DeleteModalConfirm() {

            if (IdDelete != "") {

                loading('Đang xử lý...', 1);

                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/DeletePhienLv',
                    data:
                    {
                        "Id": IdDelete,
                        "NoiDung": NoiDungDelete
                    },
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data == "") {
                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Xóa Phiếu công tác thành công',
                                type: 'success'
                            });

                            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());
                        }
                        else {
                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Lỗi : ' + data,
                                type: 'error'
                            });
                        }
                    }
                });
            }

            $.magnificPopup.close();
        }

        function UpdateVuaTaoModalDismiss() {
            $.magnificPopup.close();
        }

        function UpdateVuaTaoModalConfirm() {
            if (IdUpdateVuaTao != "") {

                loading('Đang xử lý...', 1);

                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/CapNhatTrangThaiVuaTao',
                    data:
                    {
                        "Id": IdUpdateVuaTao
                    },
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        unloading();
                        if (data.success) {
                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });

                            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());


                        }
                        else {
                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Lỗi : ' + data.responseText,
                                type: 'error'
                            });
                        }
                    }

                });
            }

            $.magnificPopup.close();
        }

        function UpdateSoPhieuModalDismiss() {
            $.magnificPopup.close();
        }

        function ClosePhieuCongTac() {
            $("#phieucongtacwords").attr("src", "");
            $.magnificPopup.close();
            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

        }

        function ClosePhieuKiemTra() {
            $("#phieuKiemTra").attr("src", "");
            $.magnificPopup.close();
        }

        function UpdateSoPhieuModalConfirm() {

            //$("#modalAnimUpdateSoPhieu").attr("style", "max-width: 1200px; height: "+ ($(document).height() - 10)  +"px;margin: 5px auto;");

            var soPhieu = $('#txtUpdateSoPhieuCT').val();

            if (soPhieu == '' || parseInt(soPhieu) <= 0) {
                new PNotify({
                    title: 'Thông báo!',
                    text: 'Số phiếu không được để trống và lớn hơn 0',
                    type: 'error'
                });

                return false;
            }

            if (soPhieu.length > 50) {
                new PNotify({
                    title: 'Thông báo!',
                    text: 'Số phiếu không được quá 50 ký tự',
                    type: 'error'
                });

                return false;
            }

            $.magnificPopup.close();

            //if (IdUpdateSoPhieu != "") {

            //    loading('Đang xử lý...', 1);

            //    $.ajax({
            //        type: "GET",
            //        contentType: "application/json; charset=utf-8",
            //        url: '/Admin/PhienLV/CapNhatSoPhieuPhienLV',
            //        data:
            //        {
            //            Id: IdUpdateSoPhieu,
            //            SoPhieu: soPhieu
            //        },
            //        dataType: "json",
            //        beforeSend: function () {//alert(id);
            //        },
            //        success: function (data) {
            //            unloading();
            //            if (data.success) {
            //                new PNotify({
            //                    title: 'Thông báo!',
            //                    text: data.responseText,
            //                    type: 'success'
            //                });

            //                Paging(1, 200, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

            //                $('#txtUpdateSoPhieuCT').val('');
            //            }
            //            else {
            //                new PNotify({
            //                    title: 'Thông báo!',
            //                    text: 'Lỗi : ' + data.responseText,
            //                    type: 'error'
            //                });

            //                $('#txtUpdateSoPhieuCT').val('');
            //            }
            //        },
            //        error: function (e) {
            //            unloading();
            //            new PNotify({
            //                title: 'Thông báo!',
            //                text: 'Đã có lỗi xảy ra',
            //                type: 'error'
            //            });

            //            $('#txtUpdateSoPhieuCT').val('');
            //        }
            //    });
            //}



        }

        function ModalConfirmTongHop() {

            //var ngayTongHop = $('#txtNgayTongHop').val();

            var ngayTongHop = '@DateTime.Now.ToString("dd/MM/yyyy")';

            if (ngayTongHop == '') {
                new PNotify({
                    title: 'Thông báo!',
                    text: 'Chọn ngày tổng hợp báo cáo',
                    type: 'error'
                });

                return false;
            }

            var scriptUrl = "/BaoCaoCuoiNgayCongTy/ValidateBaoCaoCuoiNgayTongHopPhienLV?ngayTongHop=" + ngayTongHop;
            $.ajax({
                url: scriptUrl,
                type: 'GET',
                dataType: 'json',
                beforeSend: function () {
                    //$.magnificPopup.close();
                    loading('Đang xử lý...', 1);
                },
                success: function (data) {
                    if (data.success == 1) {
                        $('#modalAnimTongHop .modal-text h3').html('Hiện phần báo cáo cuối ngày đã được chương trình tự động thực hiện từ 15h -> 15h30 chiều hàng ngày. Để cập nhật báo cáo này bạn nhấn vào đường dẫn dưới đây.<br /><a href="' + data.url + '" style="color: blue;">Báo cáo cuối ngày ' + ngayTongHop + '</a>');
                        //setTimeout(function () { $('a#btnTongHopBaoCaoCuoiNgayAlert').click(); }, 500);
                        unloading();
                    } else {
                        $('#modalAnimTongHop .modal-text h3').html('Hiện phần báo cáo cuối ngày đã được chương trình tự động thực hiện từ 15h -> 15h30 chiều hàng ngày. Để cập nhật báo cáo này bạn nhấn vào đường dẫn dưới đây.<br /><span style="color: #f00;">(Chưa có dữ liệu báo cáo cuối ngày ' + ngayTongHop + ')</span>');
                        //setTimeout(function () { $('a#btnTongHopBaoCaoCuoiNgayAlert').click(); }, 500);
                        unloading();
                    }
                        //else if (data.success == -1) {
                    //    new PNotify({
                    //        title: 'Thông báo!',
                    //        text: data.responseText,
                    //        type: 'error'
                    //    });
                    //    unloading();
                    //}
                    //else if (data.success == 0) {
                    //    $.ajax({
                    //        url: "/BaoCaoCuoiNgayCongTy/TongHopPhienLV?ngayTongHop=" + ngayTongHop,
                    //        type: 'GET',
                    //        dataType: 'json',
                    //        success: function (data) {
                    //            if (data.success) {
                    //                new PNotify({
                    //                    title: 'Thông báo!',
                    //                    text: 'Tổng hợp báo cáo thành công',
                    //                    type: 'success'
                    //                });
                    //                unloading();
                    //                window.location.href = '/BaoCaoCuoiNgayCongTy/Detail/' + data.id;
                    //            } else {
                    //                new PNotify({
                    //                    title: 'Thông báo!',
                    //                    text: 'Tổng hợp báo cáo không thành công',
                    //                    type: 'error'
                    //                });

                    //                unloading();
                    //            }
                    //        },
                    //        error: function () {
                    //            new PNotify({
                    //                title: 'Thông báo!',
                    //                text: 'Không tổng hợp được báo cáo',
                    //                type: 'error'
                    //            });

                    //            unloading();
                    //        }
                    //    });
                    //}
                },
                error: function () {
                    new PNotify({
                        title: 'Thông báo!',
                        text: 'Không tổng hợp được báo cáo',
                        type: 'error'
                    });

                    unloading();
                }
            });
        }

        function ModalDismissTongHop() {
            $.magnificPopup.close();
        }

        function ModalConfirmTongHopAlert() {

            var ngayTongHop = $('#txtNgayTongHop').val();

            if (ngayTongHop == '') {
                new PNotify({
                    title: 'Thông báo!',
                    text: 'Chọn ngày tổng hợp báo cáo',
                    type: 'error'
                });

                return false;
            }

            var scriptUrl = "/BaoCaoCuoiNgayCongTy/TongHopPhienLV?ngayTongHop=" + ngayTongHop;
            $.ajax({
                url: scriptUrl,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    if (data.success) {
                        $.magnificPopup.close();
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Tổng hợp báo cáo thành công',
                            type: 'success'
                        });

                        window.location.href = '/BaoCaoCuoiNgayCongTy/Detail/' + data.id;
                    } else {
                        $.magnificPopup.close();
                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Tổng hợp báo cáo không thành công',
                            type: 'error'
                        });
                    }
                },
                error: function () {
                    new PNotify({
                        title: 'Thông báo!',
                        text: 'Không tổng hợp được báo cáo',
                        type: 'error'
                    });
                }
            });

            $.magnificPopup.close();
        }

        function ModalDismissTongHopAlert() {
            $.magnificPopup.close();
        }

        function CapSoAllPhieuLenhModalConfirm() {

            var items = document.getElementsByClassName('chkbox');
            var listId = [];
            for (i = 0; i < items.length; i++) {
                    if (items[i].checked) {
                        listId.push(items[i].value);
                    }
            }

            if (listId.length == 0) {
                alert("Vui lòng chọn phiếu/lệnh công tác !");

            }
            else if (items.length > 0) {
                //loading('Đang xử lý...', 1);


                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/Admin/PhienLV/CapSoAllPhieuLenh',
                    data: JSON.stringify({
                        "listId": listId
                    }),
                    dataType: "json",
                    beforeSend: function () {//alert(id);
                    },
                    success: function (data) {
                        //unloading();
                        if (data != null) {

                            if (data.success) {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'success'
                                });
                            } else {

                                if (data.isDuyet == null) {

                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'error'
                                    });
                                }
                                else {
                                    new PNotify({
                                        title: 'Thông báo!',
                                        text: data.responseText,
                                        type: 'warning'
                                    });
                                }
                            }

                            Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                        }
                        else {

                            new PNotify({
                                title: 'Thông báo!',
                                text: 'Cấp số Phiếu công tác không thành công',
                                type: 'error'
                            });
                        }
                    }

                });

            }
            $.magnificPopup.close();

        }

        function CapSoAllModalDismiss() {
            $.magnificPopup.close();
        }

        function CapSoPhieuLenhModalConfirm() {

            //loading('Đang xử lý...', 1);

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/CapSoPhieuLenh',
                data: JSON.stringify({
                    "Id": IdPCT
                }),
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    //unloading();
                    if (data != null) {

                        if (data.success) {
                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });
                        } else {

                            if (data.isDuyet == null) {

                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'error'
                                });
                            }
                            else {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'warning'
                                });
                            }
                        }

                        Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                    }
                    else {

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Cấp số Phiếu công tác không thành công',
                            type: 'error'
                        });
                    }
                }

            });

            $.magnificPopup.close();
        }

        function CapSoModalDismiss() {
            $.magnificPopup.close();
        }

        function LuuNhayPhieuModalConfirm() {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/LuuNhayPhieu',
                data: JSON.stringify({
                    "SoLuong": $("#spintTongSoPhieuNhay").val(),
                    "MaLP": $("#inputLoaiPCT").val(),
                    "TramId":$("#cmbChonTram").val(),
                }),
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    //unloading();
                    if (data != null) {

                        if (data.success) {
                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });
                        } else {

                            if (data.isDuyet == null) {

                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'error'
                                });
                            }
                            else {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'warning'
                                });
                            }
                        }

                        Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                    }
                    else {

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Nhảy số Phiếu công tác không thành công',
                            type: 'error'
                        });
                    }
                }

            });

            $.magnificPopup.close();
        }

        function LuuChonPhieuModalConfirm() {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/Admin/PhienLV/LuuChonSoPhieuLenh',
                data: JSON.stringify({
                    "Id": IdPCT,
                    "MaSoPhieu":$("#cmbChonSoPhieu").val()
                }),
                dataType: "json",
                beforeSend: function () {//alert(id);
                },
                success: function (data) {
                    //unloading();
                    if (data != null) {

                        if (data.success) {
                            new PNotify({
                                title: 'Thông báo!',
                                text: data.responseText,
                                type: 'success'
                            });
                        } else {

                            if (data.isDuyet == null) {

                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'error'
                                });
                            }
                            else {
                                new PNotify({
                                    title: 'Thông báo!',
                                    text: data.responseText,
                                    type: 'warning'
                                });
                            }
                        }

                        Paging(1, 500, $("#txtSearch").val(), $('#cmbTCPhien').val(), $('#cmbTTPhienCatDien').val(), $('#cmbTTPhienTiepDia').val(), $('#cmbTTPhienKhac').val(), $('#GioBd').val(), $('#GioKt').val(), $('#cmbDonViID').val(), $('#cmbPhongBan').val(), $('#cmbDuyetNPC').val());

                    }
                    else {

                        new PNotify({
                            title: 'Thông báo!',
                            text: 'Cập nhật số Phiếu công tác không thành công',
                            type: 'error'
                        });
                    }
                }

            });

            $.magnificPopup.close();
        }

         function CancelNhayPhieuModalConfirm() {
             $.magnificPopup.close();
         }

        $("#cmbPhongBan").select2();
        $("#cmbDonViID").select2();

        let buoc = 1
        //xử lý ẩn hiện
    function onViewSign(x) {
            //Lấy tổng số file
        let numberfile = $('#numberFile').val();
            buoc = buoc + x;
            if (buoc < 0) {
                buoc = 0;
            }
        if (buoc > numberfile) {
            buoc = numberfile;
        }

        for (let i = 0; i < numberfile; i++) {
            if (buoc == i) {
                $('#obj'+i).css('display', 'block');
            }

            for (let j = 0; j < numberfile; j++) {
                if (i != j) {
                    $('#obj' + i).css('display', 'none');
                }
            }
        }

        }
    </script>
}

@*@RenderSection("JavaScriptList", required: false)*@